<%
  valid_reset_request = request.post?
%>
<!DOCTYPE html>
<html>
<head>
  <title><%= valid_reset_request ? "Reset Completed" : "Invalid Reset Request" %></title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <%= stylesheet_link_tag "application" %>
  <%= javascript_include_tag "application", defer: true %>

  <!-- Meta refresh fallback -->
  <meta http-equiv="refresh" content="3;url=<%= root_path %>">
</head>
<body class="bg-light d-flex justify-content-center align-items-center vh-100">
<div class="container">
  <div class="row justify-content-center">
    <div class="col-md-8 col-lg-6">
      <% if valid_reset_request %>
        <% ResetService.new.reset %>
        <div class="alert alert-success border-2 rounded-3 shadow-sm text-center" role="alert">
          <i class="bi bi-check-circle-fill fs-3 text-success mb-2"></i>
          <h4 class="alert-heading">Reset Completed</h4>
          <p>Your personal <em>OnDemand Loop</em> instance has been successfully reset.</p>
          <p>The application will automatically restart in <strong>3 seconds</strong>.</p>
          <hr>
          <p class="mb-0">
            If the page does not refresh, <a href="<%= restart_url %>">click here to continue</a>.
          </p>
        </div>
        <!-- Success redirect -->
        <script>
            setTimeout(function() {
                window.location.href = "<%= restart_url %>";
            }, 3000);
        </script>
      <% else %>
        <div class="alert alert-danger border-2 rounded-3 shadow-sm text-center" role="alert">
          <i class="bi bi-exclamation-octagon-fill fs-3 text-danger mb-2"></i>
          <h4 class="alert-heading">Invalid Request</h4>
          <p>The reset request is only allowed via POST.</p>
          <p>You will be redirected to the home page in <strong>3 seconds</strong>.</p>
          <hr>
          <p class="mb-0">
            If the page does not refresh, <a href="<%= root_path %>">click here to continue</a>.
          </p>
        </div>
        <!-- Error redirect -->
        <script>
            setTimeout(function() {
                window.location.href = "<%= root_path %>";
            }, 3000);
        </script>
      <% end %>
    </div>
  </div>
</div>
</body>
</html>
